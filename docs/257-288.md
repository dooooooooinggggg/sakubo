# スニッフィング

## tcpdump

```sh
tcpdump -l -X 'ip host 192.168.100.6'
```

## 生のソケット

この前のコードでは，ストリームソケットを用いた．この場合，TCP/IPに関する処理はOSに委託できた．
しかし生のソケットを扱う場合は，下位層を明示しなければならない．

raw_tcpsniff.c

```c
int main(void)
{
   int i, recv_length, sockfd;
   u_char buffer[9000];

   if ((sockfd = socket(PF_INET, SOCK_RAW, IPPROTO_TCP)) == -1)
      fatal("ソケットが生成できませんでした。");

   for (i = 0; i < 3; i++)
   {
      recv_length = recv(sockfd, buffer, 8000, 0);
      printf("%d バイトのパケットを取得しました。\n", recv_length);
      dump(buffer, recv_length);
   }
}
```

こういうコードを書く上で，マルチプラットフォームで書くのは非常に大変．

そこで，libpcapを使用すると，少し緩和される．
